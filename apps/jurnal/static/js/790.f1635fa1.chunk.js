"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[790],{893:(e,t,n)=>{n.d(t,{r:()=>i});var o,s=n(2791);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},l.apply(this,arguments)}function a(e,t){let{title:n,titleId:a,...i}=e;return s.createElement("svg",l({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},i),n?s.createElement("title",{id:a},n):null,o||(o=s.createElement("path",{d:"M6 12.7962L6 3.20377L11.4814 8L6 12.7962ZM6.6585 13.5488L12.1399 8.75258C12.5952 8.35417 12.5952 7.64584 12.1399 7.24743L6.6585 2.45119C6.01192 1.88543 5 2.34461 5 3.20377L5 12.7962C5 13.6554 6.01192 14.1146 6.6585 13.5488Z",fill:"black"})))}const i=s.forwardRef(a);n.p},2613:(e,t,n)=>{n.d(t,{Z:()=>l});n(2791);const o={user__alert:"style_user__alert__Hvfgg",user__error:"style_user__error__50+v3"};var s=n(184);function l(){return(0,s.jsx)("p",{className:[o.user__alert,o.user__error].join(" "),children:"\u0447\u0442\u043e-\u0442\u043e \u043d\u0435 \u0442\u0430\u043a..."})}},6459:(e,t,n)=>{n.d(t,{Z:()=>r});const o={date_box:"style_date_box__ki9g3",date_info:"style_date_info__FNfsQ",box:"style_box__JjG-z",input:"style_input__pRAGr",box__info:"style_box__info__gQvkY",icon:"style_icon__ZvAC-",info:"style_info__xBfct",btns_date:"style_btns_date__w2b1a",btn_date:"style_btn_date__0vsUj",icon_btn:"style_icon_btn__v3w7Y",icon_btn_left:"style_icon_btn_left__Xn-2S"};var s=n(5470),l=n(893),a=n(2791),i=n(184);function r(e){let{changeDate:t,date:n}=e,r=(0,a.useRef)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:o.date_box,children:[(0,i.jsx)("button",{className:o.btn_date,onClick:e=>{let o=new Date(n),s=o.getDate();o.setDate(s-1),console.log(o),console.log(r.current),r.current.value=o.toISOString().split("T")[0],t(o.toISOString().split("T")[0])},children:(0,i.jsx)(l.r,{className:[o.icon_btn,o.icon_btn_left].join(" ")})}),(0,i.jsxs)("label",{htmlFor:"date",className:o.box,children:[(0,i.jsxs)("div",{className:o.date_info,children:[(0,i.jsx)(s.r,{className:o.icon}),(0,i.jsx)("p",{className:o.info,children:new Intl.DateTimeFormat("ru",{day:"numeric",month:"long",year:"numeric"}).format(new Date(n))})]}),(0,i.jsx)("p",{className:o.info,children:new Intl.DateTimeFormat("ru",{weekday:"long"}).format(new Date(n))}),(0,i.jsx)("input",{type:"date",name:"date",id:"date",defaultValue:new Date(n).toISOString().split("T")[0],onChange:e=>{e.preventDefault(),t(e.target.value)},ref:r,className:o.input,min:"2023-09-01"})]}),(0,i.jsx)("button",{className:o.btn_date,onClick:e=>{let o=new Date(n),s=o.getDate();o.setDate(s+1),console.log(o),console.log(r.current),r.current.value=o.toISOString().split("T")[0],t(o.toISOString().split("T")[0])},children:(0,i.jsx)(l.r,{className:[o.icon_btn,o.icon_btn_right].join(" ")})})]})})}},4315:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(2791);const s={box:"style_box__pciF-",box_select:"style_box_select__YXC4v",box_select_none:"style_box_select_none__Wprer"};var l=n(1933),a=n(7306),i=n(184);function r(e){let{changeLesson:t,date:n}=e,[r,_]=(0,o.useState)([]),c=(0,l.useMutation)({mutationFn:e=>(0,a.a0)(e),onSuccess:(e,n,o)=>{var s;(console.table(e),_(e),e.length>0)&&(t((null===(s=e[0])||void 0===s?void 0:s.id_schedule)||null),console.log(e[0]))}});return(0,o.useEffect)((()=>{c.mutateAsync(n),console.log("Date: ",n)}),[n]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("label",{htmlFor:"lesson",className:s.box,children:Boolean(r.length)?(0,i.jsx)("select",{className:s.box_select,name:"schedule",id:"schedule_id",onChange:e=>t(Number(e.target.value)),defaultValue:r[0],children:r.map((e=>(0,i.jsxs)("option",{value:e.id_schedule,children:["\u041f\u0430\u0440\u0430 ",e.number,": ",e.name_lesson]},e.id_schedule)))}):(0,i.jsx)("p",{className:s.box_select_none,children:"\u041d\u0435\u0442\u0443 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0434\u0435\u043d\u044c"})})})}},790:(e,t,n)=>{n.r(t),n.d(t,{default:()=>x});var o=n(2791),s=n(6459),l=n(4315);const a={log:"style_log__TKQJz",iup:"style_iup__M1em8",iup_text:"style_iup_text__TlzvJ",log_n:"style_log_n__00dr-",log_nb:"style_log_nb__BeFCr",log_ny:"style_log_ny__-dEjx",log_o:"style_log_o__-Ckyj",log_def:"style_log_def__eOqui",log_name:"style_log_name__SmUeo",log_loading:"style_log_loading__-9ZdH",log_error:"style_log_error__YVldo",select:"style_select__0i-mU"};var i=n(1933),r=n(5251),_=n(3211);const c=async e=>{let t={id_student:e.id_student,id_lesson:e.id_lesson,type_log:e.type_log},n=await fetch(_.t+"/logbook",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""},body:JSON.stringify(t)});return n.ok?n.json():{status:"error"}},d=async e=>{let t={id_lesson:e.id_lesson,id_student:e.id_student,type_log:e.type_log},n=await fetch(_.t+"/logbook/extend",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""},body:JSON.stringify(t)});return n.ok?n.json():{status:"error"}},u=async e=>{let t={type_log:e.type_log,id:e.id},n=await fetch(_.t+"/logbook",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""},body:JSON.stringify(t)});return n.ok?n.json():{status:"error"}},g=async(e,t)=>{let n={id_lesson:e,date_lesson:t},o=await fetch(_.t+"/logbooks",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""},body:JSON.stringify(n)});return o.ok?o.json():{status:"error"}},h=async e=>{let t=await fetch("".concat(_.t,"/logbook?id=").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""}});return t.ok?t.json():{status:"error"}},m=async(e,t)=>(await fetch("".concat(_.t,"/shortcreate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""},body:JSON.stringify({date_lesson:new Date(e).toISOString().split("T")[0],number_lesson:t})})).json();var p=n(184);function y(e){let t=e=>{switch(e.trim()){case"\u043d":return a.log_n;case"\u043d\u0431":return a.log_nb;case"\u043d\u0443":return a.log_ny;case"\u043e":return a.log_o;default:return a.log_def}},[n,s]=(0,o.useState)([a.log,t(e.log_state)].join(" ")),[l,_]=(0,o.useState)({id:e.id_log,type:e.log_state}),g=((0,i.useMutation)({mutationFn:e=>d(e),onSuccess:(e,t,n)=>{console.table(e),console.table(t),console.table(n)}}),(0,i.useMutation)({mutationFn:e=>c(e),onSuccess:(e,n,o)=>{_({id:e[0].id_log,type:e[0].type_log}),s((()=>[a.log,t(n.type_log)].join(" ")))}})),m=(0,i.useMutation)({mutationFn:e=>u(e),onSuccess:(e,n,o)=>{var i,r;_({id:(null===(i=e[0])||void 0===i?void 0:i.id_log)||l.id,type:(null===(r=e[0])||void 0===r?void 0:r.type_log)||l.type}),s((()=>[a.log,t(n.type_log)].join(" ")))}}),y=(0,i.useMutation)({mutationFn:e=>h(e),onSuccess:(n,o,i)=>{_({...l,type:void 0}),s((()=>[a.log,t(""),Boolean(null!=e.date_start)&&Boolean(null!=e.date_end)?a.iup:""].join(" ")))}});return(0,p.jsxs)("label",{className:n,children:[(0,p.jsx)("div",{className:a.state_marks,children:Boolean(null!=e.date_start)&&Boolean(null!=e.date_end)?(0,p.jsx)("p",{className:a.iup_text,children:"\u0418\u0423\u041f"}):null}),(0,p.jsxs)("div",{className:a.state_box,children:[g.isLoading&&(0,p.jsx)(r.Z,{size_w:20,size_h:20}),g.isError&&(0,p.jsx)("span",{className:a.log_error,children:"\u041e\u0448\u0438\u0431\u043a\u0430!"})]}),(0,p.jsxs)("div",{className:a.state_info,children:[(0,p.jsx)("p",{className:a.log_name,children:e.student_name}),(0,p.jsxs)("select",{name:"state",id:"state",className:a.select,onChange:t=>{"-"!==t.target.value&&null===l.id?(console.log("handlerChose (new state)"),g.mutate({id_student:e.id_student,id_lesson:e.id_lesson,type_log:t.target.value})):"-"===t.target.value&&void 0!==l.id?y.mutate(l.id):l.type!==t.target.value&&void 0!==l.id&&m.mutate({id:l.id,type_log:t.target.value}),console.groupEnd()},defaultValue:e.log_state||"",children:[(0,p.jsx)("option",{value:"-",children:"\u041d\u0430 \u043c\u0435\u0441\u0442\u0435"}),(0,p.jsx)("option",{value:"\u043d",children:"\u041f\u0440\u043e\u0433\u0443\u043b"}),(0,p.jsx)("option",{value:"\u043d\u0431",children:"\u0411\u043e\u043b\u0435\u0437\u043d\u044c"}),(0,p.jsx)("option",{value:"\u043d\u0443",children:"\u0423\u0432\u0430\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f"}),(0,p.jsx)("option",{value:"\u043e",children:"\u041e\u043f\u043e\u0437\u0434\u0430\u043d\u0438\u0435"})]})]}),(0,p.jsx)("div",{className:a.state_functions,children:Boolean(!["-","\u043e"].includes(e.log_state))?(0,p.jsx)("button",{className:a.functions_btn,onClick:async()=>{await d({type_log:e.log_state,id_student:e.id_student,id_lesson:e.id_lesson})},children:(0,p.jsx)("span",{children:"\u041f\u0440\u043e\u0434\u043b\u0438\u0442\u044c"})}):null})]})}const b="style_ya_share__7E+mK",j=e=>((0,o.useEffect)((()=>{window.Ya.share2("ya",{theme:{services:"",copy:"extraItem","data-size":"l"},content:{url:e.link}})}),[]),(0,p.jsx)("div",{id:"ya",className:b}));var f=n(2613);function x(){let[e,t]=(0,o.useState)([]),[n,a]=(0,o.useState)((()=>(new Date).toISOString().split("T")[0])),[_,c]=(0,o.useState)(null),[d,u]=(0,o.useState)("");let h=(0,i.useMutation)({mutationFn:(e,t)=>g(e,t),onSuccess:e=>{t(e)}}),b=(0,i.useMutation)({mutationFn:(e,t)=>m(e,t),onSuccess:e=>{u(window.location.origin+"/p/apps/jurnal/#/share/logbook/"+e.token)}});return(0,o.useEffect)((()=>{_&&h.mutate(_,n),c(null)}),[n]),(0,o.useEffect)((()=>{_&&h.mutate(_,n)}),[_]),(0,o.useEffect)((()=>{console.table({date:n,lesson_id:_})}),[n,_]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(s.Z,{changeDate:a,date:n}),(0,p.jsx)(l.Z,{changeLesson:c,date:n}),h.isLoading&&(0,p.jsx)(r.Z,{}),h.isError&&(0,p.jsx)(f.Z,{}),(0,p.jsx)("button",{className:"logbook__share__btn",onClick:(e,t)=>{b.mutate()},children:(0,p.jsx)("span",{children:"\u041f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f"})}),Boolean(_)&&b.isSuccess&&(0,p.jsxs)("div",{className:"logbook__share",children:[(0,p.jsx)(j,{link:d}),(0,p.jsx)("a",{href:d,children:"\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0441\u0435\u0449\u0430\u0435\u043c\u043e\u0441\u0442\u0438"})]}),(0,p.jsx)("div",{className:"logbook_list",children:Boolean(e.length)&&Boolean(_)&&!h.isLoading?e.map(((e,t)=>(0,p.jsx)(y,{id_lesson:_,student_name:e.full_name,id_student:e.id_student,log_state:e.type_log||"",id_log:e.id_log,date_start:e.date_start,date_end:e.date_end},e.id_student))):null})]})}},7306:(e,t,n)=>{n.d(t,{a0:()=>s});var o=n(3211);const s=async e=>{console.log(">> RQ +start -----------===----");let t={date_lesson:e},n=await fetch("".concat(o.t,"/schedule/day"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||""},body:JSON.stringify(t)});return n.ok?n.json():{status:"error"}}}}]);
//# sourceMappingURL=790.f1635fa1.chunk.js.map